name: self-hosted

services:
    prometheus:
        image: prom/prometheus
        container_name: prometheus
        networks:
            - prometheus_network
        volumes:
            - ./prometheus.yml:/etc/prometheus/prometheus.yml
            - prometheus_data:/prometheus
        restart: unless-stopped
        deploy:
            resources:
                limits:
                    cpus: "2.0"
                    memory: 4096M
                reservations:
                    memory: 512M

    node-exporter:
        image: quay.io/prometheus/node-exporter:latest
        container_name: node-exporter
        networks:
            - prometheus_network
        volumes:
            - /:/host:ro,rslave
        command: --path.rootfs=/host
        restart: unless-stopped
        deploy:
            resources:
                limits:
                    cpus: "0.1"
                    memory: 64M

networks:
    prometheus_network:
        name: prometheus_network

volumes:
    prometheus_data:
        name: prometheus_data
        driver: local
